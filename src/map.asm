map .namespace
.section code
handlePosition
    lda posY
    ldx pixelsY
    jsr setTilePositionY
    rts

moveNorth
    lda posY
    cmp #0
    bne _continue
    rts
_continue
    lda pixelsY
    cmp #0
    beq _changeTile
    dec pixelsY
    rts
_changeTile
    lda #15
    sta pixelsY
    lda posY
    sec
    sbc #1
    sta posY
    lda posY + 1
    sbc #0
    sta posY + 1
    rts

;a x coordinate
;x y coordinate
getTile
    sta xTile
    stx yTile

    lda yTile
    tay
    lda loByte,y
    sta tmpPos
    lda lookupY,y
    sta tmpPos + 1
    lda xTile
    clc
    adc xTile
    adc tmpPos
    sta tmpPos
    lda tmpPos + 1
    adc #0
    sta tmpPos + 1

    lda tmpPos
    sta POINTER_SRC
    lda tmpPos + 1
    adc #0
    sta POINTER_SRC + 1
    lda #$b3
    sta MMU_MEM_CTRL
    lda $D
    pha
    lda #$30
    sta $d

    ldy #0
    lda (POINTER_SRC),y
    sta tileNumber
    pla
    sta $d
    rts

init
    lda #0
    jsr setTileMapNumber

    lda #<mTileSetStart
    ldx #>mTileSetStart
    ldy #`mTileSetStart
    jsr setTileSetAddress

    lda #<mTileMapStart
    ldx #>mTileMapStart
    ldy #`mTileMapStart
    jsr setTileMapAddress

    lda #start
    sta posY
    lda #0
    sta posY + 1

    lda #0
    sta pixelsY

    lda #width
    ldx #height
    jsr setMapSize

    lda posY
    ldx posY + 1
    jsr setTilePositionY

    rts
.endsection 
.section variables
width= 21
height= 194
start= height-15
posX
    .byte 0,0
posY
    .byte 0,0
pixelsX
    .byte 0
pixelsY
    .byte 0

tmpPos
    .byte 0,0
xTile
    .byte 0
yTile
    .byte 0
tileNumber
    .byte 0
lookupY
.byte $A0
.byte $A0
.byte $A0
.byte $A0
.byte $A0
.byte $A0
.byte $A0
.byte $A1
.byte $A1
.byte $A1
.byte $A1
.byte $A1
.byte $A1
.byte $A2
.byte $A2
.byte $A2
.byte $A2
.byte $A2
.byte $A2
.byte $A3
.byte $A3
.byte $A3
.byte $A3
.byte $A3
.byte $A3
.byte $A4
.byte $A4
.byte $A4
.byte $A4
.byte $A4
.byte $A4
.byte $A5
.byte $A5
.byte $A5
.byte $A5
.byte $A5
.byte $A5
.byte $A6
.byte $A6
.byte $A6
.byte $A6
.byte $A6
.byte $A6
.byte $A7
.byte $A7
.byte $A7
.byte $A7
.byte $A7
.byte $A7
.byte $A8
.byte $A8
.byte $A8
.byte $A8
.byte $A8
.byte $A8
.byte $A9
.byte $A9
.byte $A9
.byte $A9
.byte $A9
.byte $A9
.byte $AA
.byte $AA
.byte $AA
.byte $AA
.byte $AA
.byte $AA
.byte $AA
.byte $AB
.byte $AB
.byte $AB
.byte $AB
.byte $AB
.byte $AB
.byte $AC
.byte $AC
.byte $AC
.byte $AC
.byte $AC
.byte $AC
.byte $AD
.byte $AD
.byte $AD
.byte $AD
.byte $AD
.byte $AD
.byte $AE
.byte $AE
.byte $AE
.byte $AE
.byte $AE
.byte $AE
.byte $AF
.byte $AF
.byte $AF
.byte $AF
.byte $AF
.byte $AF
.byte $B0
.byte $B0
.byte $B0
.byte $B0
.byte $B0
.byte $B0
.byte $B1
.byte $B1
.byte $B1
.byte $B1
.byte $B1
.byte $B1
.byte $B2
.byte $B2
.byte $B2
.byte $B2
.byte $B2
.byte $B2
.byte $B3
.byte $B3
.byte $B3
.byte $B3
.byte $B3
.byte $B3
.byte $B4
.byte $B4
.byte $B4
.byte $B4
.byte $B4
.byte $B4
.byte $B5
.byte $B5
.byte $B5
.byte $B5
.byte $B5
.byte $B5
.byte $B5
.byte $B6
.byte $B6
.byte $B6
.byte $B6
.byte $B6
.byte $B6
.byte $B7
.byte $B7
.byte $B7
.byte $B7
.byte $B7
.byte $B7
.byte $B8
.byte $B8
.byte $B8
.byte $B8
.byte $B8
.byte $B8
.byte $B9
.byte $B9
.byte $B9
.byte $B9
.byte $B9
.byte $B9
.byte $BA
.byte $BA
.byte $BA
.byte $BA
.byte $BA
.byte $BA
.byte $BB
.byte $BB
.byte $BB
.byte $BB
.byte $BB
.byte $BB
.byte $BC
.byte $BC
.byte $BC
.byte $BC
.byte $BC
.byte $BC
.byte $BD
.byte $BD
.byte $BD
.byte $BD
.byte $BD
.byte $BD
.byte $BE
.byte $BE
.byte $BE
.byte $BE
.byte $BE
.byte $BE
.byte $BF
.byte $BF
.byte $BF
.byte $BF
.byte $BF
.byte $BF
.byte $BF
.byte $C0
.byte $C0
.byte $C0
.byte $C0
.byte $C0
.byte $C0
.byte $C1
.byte $C1
.byte $C1
.byte $C1
.byte $C1
.byte $C1
.byte $C2
.byte $C2
.byte $C2
.byte $C2
.byte $C2
.byte $C2
.byte $C3
.byte $C3
.byte $C3
.byte $C3
.byte $C3
.byte $C3
.byte $C4
.byte $C4
.byte $C4
.byte $C4
.byte $C4
.byte $C4
.byte $C5
.byte $C5
.byte $C5
.byte $C5
.byte $C5
.byte $C5
.byte $C6
.byte $C6
.byte $C6
.byte $C6
.byte $C6
.byte $C6
.byte $C7
.byte $C7
.byte $C7
.byte $C7
.byte $C7
.byte $C7
.byte $C8

loByte
.byte $00
.byte $2A
.byte $54
.byte $7E
.byte $A8
.byte $D2
.byte $FC
.byte $26
.byte $50
.byte $7A
.byte $A4
.byte $CE
.byte $F8
.byte $22
.byte $4C
.byte $76
.byte $A0
.byte $CA
.byte $F4
.byte $1E
.byte $48
.byte $72
.byte $9C
.byte $C6
.byte $F0
.byte $1A
.byte $44
.byte $6E
.byte $98
.byte $C2
.byte $EC
.byte $16
.byte $40
.byte $6A
.byte $94
.byte $BE
.byte $E8
.byte $12
.byte $3C
.byte $66
.byte $90
.byte $BA
.byte $E4
.byte $0E
.byte $38
.byte $62
.byte $8C
.byte $B6
.byte $E0
.byte $0A
.byte $34
.byte $5E
.byte $88
.byte $B2
.byte $DC
.byte $06
.byte $30
.byte $5A
.byte $84
.byte $AE
.byte $D8
.byte $02
.byte $2C
.byte $56
.byte $80
.byte $AA
.byte $D4
.byte $FE
.byte $28
.byte $52
.byte $7C
.byte $A6
.byte $D0
.byte $FA
.byte $24
.byte $4E
.byte $78
.byte $A2
.byte $CC
.byte $F6
.byte $20
.byte $4A
.byte $74
.byte $9E
.byte $C8
.byte $F2
.byte $1C
.byte $46
.byte $70
.byte $9A
.byte $C4
.byte $EE
.byte $18
.byte $42
.byte $6C
.byte $96
.byte $C0
.byte $EA
.byte $14
.byte $3E
.byte $68
.byte $92
.byte $BC
.byte $E6
.byte $10
.byte $3A
.byte $64
.byte $8E
.byte $B8
.byte $E2
.byte $0C
.byte $36
.byte $60
.byte $8A
.byte $B4
.byte $DE
.byte $08
.byte $32
.byte $5C
.byte $86
.byte $B0
.byte $DA
.byte $04
.byte $2E
.byte $58
.byte $82
.byte $AC
.byte $D6
.byte $00
.byte $2A
.byte $54
.byte $7E
.byte $A8
.byte $D2
.byte $FC
.byte $26
.byte $50
.byte $7A
.byte $A4
.byte $CE
.byte $F8
.byte $22
.byte $4C
.byte $76
.byte $A0
.byte $CA
.byte $F4
.byte $1E
.byte $48
.byte $72
.byte $9C
.byte $C6
.byte $F0
.byte $1A
.byte $44
.byte $6E
.byte $98
.byte $C2
.byte $EC
.byte $16
.byte $40
.byte $6A
.byte $94
.byte $BE
.byte $E8
.byte $12
.byte $3C
.byte $66
.byte $90
.byte $BA
.byte $E4
.byte $0E
.byte $38
.byte $62
.byte $8C
.byte $B6
.byte $E0
.byte $0A
.byte $34
.byte $5E
.byte $88
.byte $B2
.byte $DC
.byte $06
.byte $30
.byte $5A
.byte $84
.byte $AE
.byte $D8
.byte $02
.byte $2C
.byte $56
.byte $80
.byte $AA
.byte $D4
.byte $FE
.byte $28
.byte $52
.byte $7C
.byte $A6
.byte $D0
.byte $FA
.byte $24
.byte $4E
.byte $78
.byte $A2
.byte $CC
.byte $F6
.byte $20
.byte $4A
.byte $74
.byte $9E
.byte $C8
.byte $F2
.byte $1C
.byte $46
.byte $70
.byte $9A
.byte $C4
.byte $EE
.byte $18
.byte $42
.byte $6C
.byte $96
.byte $C0
.byte $EA
.byte $14
.byte $3E
.byte $68
.byte $92
.byte $BC
.byte $E6
.byte $10
.byte $3A
.byte $64
.byte $8E
.byte $B8
.byte $E2
.byte $0C
.byte $36
.byte $60
.byte $8A
.byte $B4
.byte $DE
.byte $08
.endsection
.endnamespace